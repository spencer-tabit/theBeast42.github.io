---
title: "final_project"
author: "Spencer Tabit"
date: "May 18, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(dplyr)
library(tidyr)
library(lubridate)
library(ggplot2)
library(purrr)
library(rvest)
library(magrittr)
library(stringr)
```



```{r message = FALSE, warning=FALSE}
setwd("~/College/CMSC320/Final Project/data/regularSeason")

regular_seasons <- 
  rbind(
    read_csv("nba_1988-89.csv") %>% mutate(season = "1988-89"),
    read_csv("nba_1989-90.csv") %>% mutate(season = "1989-90")
  ) %>%
  rbind(
    read_csv("nba_1990-91.csv") %>% mutate(season = "1990-91")
  ) %>%
  rbind(
    read_csv("nba_1991-92.csv") %>% mutate(season = "1991-92")
  ) %>%
  rbind (
    read_csv("nba_1992-93.csv") %>% mutate(season = "1992-93")
  ) %>%
  rbind(
    read_csv("nba_1993-94.csv") %>% mutate(season = "1993-94")
  ) %>%
  rbind(
    read_csv("nba_1994-95.csv") %>% mutate(season = "1994-95")
  ) %>%
  rbind(
    read_csv("nba_1995-96.csv") %>% mutate(season = "1995-96")
  ) %>%
  rbind(
    read_csv("nba_1996-97.csv") %>% mutate(season = "1996-97")
  ) %>%
  rbind(
    read_csv("nba_1997-98.csv") %>% mutate(season = "1997-98")
  ) %>%
  rbind(
    read_csv("nba_1998-99.csv") %>% mutate(season = "1998-99")
  ) %>%
  rbind(
    read_csv("nba_1999-00.csv") %>% mutate(season = "1999-00")
  ) %>% 
  rbind(
    read_csv("nba_2000-01.csv") %>% mutate(season = "2000-01")
  ) %>% 
  rbind(
    read_csv("nba_2001-02.csv") %>% mutate(season = "2001-02")
  ) %>% 
  rbind(
    read_csv("nba_2002-03.csv") %>% mutate(season = "2002-03")
  ) %>% 
  rbind(
    read_csv("nba_2003-04.csv") %>% mutate(season = "2003-04")
  ) %>% 
  rbind(
    read_csv("nba_2004-05.csv") %>% mutate(season = "2004-05")
  ) %>% 
  rbind(
    read_csv("nba_2005-06.csv") %>% mutate(season = "2005-06")
  ) %>% 
  rbind(
    read_csv("nba_2006-07.csv") %>% mutate(season = "2006-07")
  ) %>% 
  rbind(
    read_csv("nba_2007-08.csv") %>% mutate(season = "2007-08")
  ) %>% 
  rbind(
    read_csv("nba_2008-09.csv") %>% mutate(season = "2008-09")
  ) %>% 
  rbind(
    read_csv("nba_2009-10.csv") %>% mutate(season = "2009-10")
  ) %>% 
  rbind(
    read_csv("nba_2010-11.csv") %>% mutate(season = "2010-11")
  ) %>% 
  rbind(
    read_csv("nba_2011-12.csv") %>% mutate(season = "2011-12")
  ) %>% 
  rbind(
    read_csv("nba_2012-13.csv") %>% mutate(season = "2012-13")
  ) %>% 
  rbind(
    read_csv("nba_2013-14.csv") %>% mutate(season = "2013-14")
  ) %>% 
  rbind(
    read_csv("nba_2014-15.csv") %>% mutate(season = "2014-15")
  ) %>% 
  rbind(
    read_csv("nba_2015-16.csv") %>% mutate(season = "2015-16")
  ) %>% 
  rbind(
    read_csv("nba_2016-17.csv") %>% mutate(season = "2016-17")
  ) %>% 
  rbind(
    read_csv("nba_2017-18.csv") %>% mutate(season = "2017-18")
  ) %>%
  mutate(player = str_trim(Name)) %>%
  select(-Name)

regular_seasons
```
```{r message = FALSE, warning=FALSE}
all_nba_team_players_url <- "https://en.wikipedia.org/wiki/All-NBA_Team"

all_nba_team_players_data <- all_nba_team_players_url %>%
  read_html() %>%
  html_node("#mw-content-text > div > table:nth-child(24)") %>%
  html_table(fill=TRUE) %>%
  set_colnames(c("season", "first_players", "first_players_team", "second_players", "second_players_team", "third_players", "third_players_team")) %>%
  as_tibble()

all_nba_team_players_data <- all_nba_team_players_data %>%
  slice(2:151)

all_nba_team_first_data <- all_nba_team_players_data %>%
  select(season, first_players, first_players_team) %>%
  mutate(first_team = 1) %>%
  mutate(second_team = 0) %>%
  mutate(third_team = 0) %>%
  mutate(all_nba_team = "first") %>%
  mutate(player = first_players) %>%
  mutate(team = first_players_team) %>%
  select(season, player, team, first_team, second_team, third_team, all_nba_team)
  


all_nba_team_second_data <- all_nba_team_players_data %>%
  select(season, second_players, second_players_team) %>%
  mutate(first_team = 0) %>%
  mutate(second_team = 1) %>%
  mutate(third_team = 0) %>%
  mutate(all_nba_team = "second") %>%
  mutate(player = second_players) %>%
  mutate(team = second_players_team) %>%
  select(season, player, team, first_team, second_team, third_team, all_nba_team)

all_nba_team_third_data <- all_nba_team_players_data %>%
  select(season, third_players, third_players_team) %>%
  mutate(first_team = 0) %>%
  mutate(second_team = 0) %>%
  mutate(third_team = 1) %>%
  mutate(all_nba_team = "third") %>%
  mutate(player = third_players) %>%
  mutate(team = third_players_team) %>%
  select(season, player, team, first_team, second_team, third_team, all_nba_team)

all_nba_team_players_data <- all_nba_team_first_data %>%
  full_join(all_nba_team_second_data, by= c("season", "player", "team", "first_team", "second_team", "third_team", "all_nba_team")) %>%
  full_join(all_nba_team_third_data, by =c("season", "player", "team", "first_team", "second_team", "third_team", "all_nba_team")) %>%
  arrange(season)

all_nba_team_players_data <- all_nba_team_players_data %>%
  mutate(player = str_extract(player, "^(\\w|'|-)* [A-Za-z]*")) %>%
  mutate(season = str_c(str_extract(season, "^\\d*"),str_extract(str_trim(season), "\\d*$"), sep = "-"))

all_nba_team_players_data
```  

```{r}
# all_nba_with_stats <- all_nba_team_players_data %>%
#   left_join(regular_seasons, by = c("player", "season")) %>%
#   na.omit()
  
regular_seasons <- regular_seasons %>%
  left_join(all_nba_team_players_data, by = c("player", "season"))
 
regular_seasons <- mutate(regular_seasons, first_team = if_else(is.na(regular_seasons$first_team), 0, first_team)) %>%
  mutate(second_team = if_else(is.na(regular_seasons$second_team), 0, regular_seasons$second_team)) %>%
  mutate(third_team = if_else(is.na(regular_seasons$third_team), 0, regular_seasons$third_team)) %>%
  mutate(is_all_nba = if_else(is.na(regular_seasons$all_nba_team), 0, 1)) %>%
  mutate(all_nba_team = if_else(is.na(regular_seasons$all_nba_team), "none", regular_seasons$all_nba_team))

regular_seasons
``` 

```{r }

``` 




